<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>환경 토론 투표 예측 게임 (에너지 절약)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    .btn-hover:hover {
      transform: scale(1.05);
      transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
    }
    .btn-active:active {
      transform: scale(0.95);
      transition: transform 0.1s ease-in-out;
      background-color: #1e3a8a;
    }
    #loadingSpinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .spinner {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #1e40af;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 10000;
      text-align: center;
      max-width: 90%;
    }
  </style>
</head>
<body class="bg-gradient-to-r from-blue-100 to-blue-200 min-h-screen flex items-center justify-center font-sans">
  <div id="loadingSpinner">
    <div class="spinner"></div>
  </div>
  <div id="popup" class="hidden">
    <p id="popupMessage" class="text-lg font-semibold text-blue-800"></p>
    <button id="popupConfirm" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg btn-hover btn-active">확인</button>
  </div>

  <!-- Page 1: Group Name -->
  <div id="page1" class="w-full max-w-md mx-auto p-6">
    <h1 class="text-2xl font-bold text-blue-800 text-center mb-4">환경 토론 투표 예측 게임 (에너지 절약)</h1>
    <p class="text-center text-blue-600 mb-6">Host가 알려준 단체명을 입력합니다. 대소문자 구분해서 정확히 입력해 주세요.</p>
    <div class="flex items-center justify-center mb-6">
      <i class="fas fa-users mr-2 text-blue-600"></i>
      <input id="groupName" type="text" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="단체명 입력">
    </div>
    <div class="text-center">
      <button onclick="goToPage(2)" class="bg-blue-600 text-white px-6 py-3 rounded-lg btn-hover btn-active">다음</button>
    </div>
  </div>

  <!-- Page 2: Team Name -->
  <div id="page2" class="w-full max-w-md mx-auto p-6 hidden">
    <h1 class="text-2xl font-bold text-blue-800 text-center mb-2">환경 토론 투표 예측 게임 (에너지 절약)</h1>
    <p class="text-center text-blue-600 mb-4">단체명: <span id="groupNameDisplay2" class="font-semibold"></span></p>
    <div class="flex items-center justify-center mb-6">
      <i class="fas fa-user-friends mr-2 text-blue-600"></i>
      <select id="teamName" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        <option value="" disabled selected>팀 선택</option>
        <?php for ($i = 1; $i <= 60; $i++): ?>
          <option value="팀<?=$i?>">팀<?=$i?></option>
        <?php endfor; ?>
      </select>
    </div>
    <div class="text-center flex justify-center space-x-4">
      <button onclick="goToPage(1)" class="bg-gray-400 text-white px-6 py-3 rounded-lg btn-hover btn-active">뒤로 가기</button>
      <button onclick="goToPage(3)" class="bg-blue-600 text-white px-6 py-3 rounded-lg btn-hover btn-active">다음</button>
    </div>
  </div>

  <!-- Page 3: Round Selection -->
  <div id="page3" class="w-full max-w-md mx-auto p-6 hidden">
    <h1 class="text-2xl font-bold text-blue-800 text-center mb-2">환경 토론 투표 예측 게임 (에너지 절약)</h1>
    <p class="text-center text-blue-600 mb-2">단체명: <span id="groupNameDisplay3" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">팀명: <span id="teamNameDisplay3" class="font-semibold"></span></p>
    <div class="flex items-center justify-center mb-6">
      <i class="fas fa-list-ol mr-2 text-blue-600"></i>
      <select id="round" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        <option value="" disabled selected>라운드 선택</option>
        <?php for ($i = 1; $i <= 10; $i++): ?>
          <option value="라운드<?=$i?>">라운드<?=$i?></option>
        <?php endfor; ?>
      </select>
    </div>
    <div class="text-center flex justify-center space-x-4">
      <button onclick="goToPage(2)" class="bg-gray-400 text-white px-6 py-3 rounded-lg btn-hover btn-active">뒤로 가기</button>
      <button onclick="goToPage(4)" class="bg-blue-600 text-white px-6 py-3 rounded-lg btn-hover btn-active">다음</button>
    </div>
  </div>

  <!-- Page 4: Choice Selection -->
  <div id="page4" class="w-full max-w-md mx-auto p-6 hidden">
    <h1 class="text-2xl font-bold text-blue-800 text-center mb-2">환경 토론 투표 예측 게임 (에너지 절약)</h1>
    <p class="text-center text-blue-600 mb-2">단체명: <span id="groupNameDisplay4" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">팀명: <span id="teamNameDisplay4" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">나의 선택</p>
    <div class="flex items-center justify-center mb-6">
      <i class="fas fa-check-circle mr-2 text-blue-600"></i>
      <select id="choice" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        <option value="" disabled selected>선택</option>
        <option value="찬성(1번)">찬성(1번)</option>
        <option value="반대(2번)">반대(2번)</option>
      </select>
    </div>
    <div class="text-center flex justify-center space-x-4">
      <button onclick="goToPage(3)" class="bg-gray-400 text-white px-6 py-3 rounded-lg btn-hover btn-active">뒤로 가기</button>
      <button onclick="goToPage(5)" class="bg-blue-600 text-white px-6 py-3 rounded-lg btn-hover btn-active">다음</button>
    </div>
  </div>

  <!-- Page 5: Percentage Prediction -->
  <div id="page5" class="w-full max-w-md mx-auto p-6 hidden">
    <h1 class="text-2xl font-bold text-blue-800 text-center mb-2">환경 토론 투표 예측 게임 (에너지 절약)</h1>
    <p class="text-center text-blue-600 mb-2">단체명: <span id="groupNameDisplay5" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">팀명: <span id="teamNameDisplay5" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">나의 선택과 같은 선택을 하는 % 예측</p>
    <div class="flex items-center justify-center mb-6">
      <i class="fas fa-percentage mr-2 text-blue-600"></i>
      <select id="percentage" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        <option value="" disabled selected>% 선택</option>
        <?php foreach ([2,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,98] as $p): ?>
          <option value="<?=$p?>"><?=$p?></option>
        <?php endfor; ?>
      </select>
    </div>
    <div class="text-center flex justify-center space-x-4">
      <button onclick="goToPage(4)" class="bg-gray-400 text-white px-6 py-3 rounded-lg btn-hover btn-active">뒤로 가기</button>
      <button onclick="goToPage(6)" class="bg-blue-600 text-white px-6 py-3 rounded-lg btn-hover btn-active">다음</button>
    </div>
  </div>

  <!-- Page 6: Betting Selection -->
  <div id="page6" class="w-full max-w-md mx-auto p-6 hidden">
    <h1 class="text-2xl font-bold text-blue-800 text-center mb-2">환경 토론 투표 예측 게임 (에너지 절약)</h1>
    <p class="text-center text-blue-600 mb-2">단체명: <span id="groupNameDisplay6" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">팀명: <span id="teamNameDisplay6" class="font-semibold"></span></p>
    <p class="text-center text-blue-600 mb-4">베팅 선택</p>
    <div class="flex items-center justify-center mb-6">
      <i class="fas fa-coins mr-2 text-blue-600"></i>
      <select id="bet" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        <option value="" disabled selected>베팅 선택</option>
        <?php for ($i = 1; $i <= 9; $i++): ?>
          <option value="<?=$i?>"><?=$i?></option>
        <?php endfor; ?>
      </select>
    </div>
    <div class="text-center flex justify-center space-x-4">
      <button onclick="goToPage(5)" class="bg-gray-400 text-white px-6 py-3 rounded-lg btn-hover btn-active">뒤로 가기</button>
      <button onclick="submitData()" id="submitBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg btn-hover btn-active">제출하기</button>
    </div>
  </div>

  <script>
    let formData = {
      groupName: '',
      teamName: '',
      round: '',
      choice: '',
      percentage: '',
      bet: ''
    };
    let isSubmitting = false;

    function showPage(pageNum) {
      for (let i = 1; i <= 6; i++) {
        document.getElementById(`page${i}`).classList.add('hidden');
      }
      document.getElementById(`page${pageNum}`).classList.remove('hidden');
    }

    function goToPage(pageNum) {
      if (pageNum === 2 && !document.getElementById('groupName').value) {
        alert('단체명을 입력해주세요.');
        return;
      }
      if (pageNum === 3 && !document.getElementById('teamName').value) {
        alert('팀명을 선택해주세요.');
        return;
      }
      if (pageNum === 4 && !document.getElementById('round').value) {
        alert('라운드를 선택해주세요.');
        return;
      }
      if (pageNum === 5 && !document.getElementById('choice').value) {
        alert('선택을 입력해주세요.');
        return;
      }
      if (pageNum === 6 && !document.getElementById('percentage').value) {
        alert('예측 %를 선택해주세요.');
        return;
      }

      formData.groupName = document.getElementById('groupName').value || formData.groupName;
      formData.teamName = document.getElementById('teamName').value || formData.teamName;
      formData.round = document.getElementById('round').value || formData.round;
      formData.choice = document.getElementById('choice').value || formData.choice;
      formData.percentage = document.getElementById('percentage').value || formData.percentage;

      if (pageNum >= 2) document.getElementById('groupNameDisplay2').textContent = formData.groupName;
      if (pageNum >= 3) {
        document.getElementById('groupNameDisplay3').textContent = formData.groupName;
        document.getElementById('teamNameDisplay3').textContent = formData.teamName;
      }
      if (pageNum >= 4) {
        document.getElementById('groupNameDisplay4').textContent = formData.groupName;
        document.getElementById('teamNameDisplay4').textContent = formData.teamName;
      }
      if (pageNum >= 5) {
        document.getElementById('groupNameDisplay5').textContent = formData.groupName;
        document.getElementById('teamNameDisplay5').textContent = formData.teamName;
      }
      if (pageNum >= 6) {
        document.getElementById('groupNameDisplay6').textContent = formData.groupName;
        document.getElementById('teamNameDisplay6').textContent = formData.teamName;
      }

      showPage(pageNum);
    }

    function submitData() {
      if (isSubmitting) return;
      if (!document.getElementById('bet').value) {
        alert('베팅을 선택해주세요.');
        return;
      }

      formData.bet = document.getElementById('bet').value;
      isSubmitting = true;
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('loadingSpinner').style.display = 'flex';

      fetch('https://script.google.com/macros/s/AKfycbx1lY2Z1bNxW4MCtqCT322MOQeKHxugSzqF9rf8SaOTRgMmfDZUVycpQ6FVYfLXUPPs/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      })
      .then(() => {
        document.getElementById('loadingSpinner').style.display = 'none';
        const currentRound = parseInt(formData.round.replace('라운드', ''));
        showPopup(currentRound === 10 ? '모든 입력이 완료되었습니다!' : `입력이 성공했습니다: ${formData.groupName}, ${formData.teamName}, ${formData.round} 내용이 잘 입력됐습니다.`);
        document.getElementById('popupConfirm').onclick = () => {
          if (currentRound === 10) {
            resetForm();
            showPage(1);
          } else {
            document.getElementById('round').value = `라운드${currentRound + 1}`;
            document.getElementById('choice').value = '';
            document.getElementById('percentage').value = '';
            document.getElementById('bet').value = '';
            formData.choice = '';
            formData.percentage = '';
            formData.bet = '';
            showPage(3);
          }
          document.getElementById('popup').style.display = 'none';
        };
        setTimeout(() => {
          isSubmitting = false;
          document.getElementById('submitBtn').disabled = false;
        }, 3000);
      })
      .catch(() => {
        document.getElementById('loadingSpinner').style.display = 'none';
        const currentRound = parseInt(formData.round.replace('라운드', ''));
        showPopup(currentRound === 10 ? '모든 입력이 완료되었습니다!' : `입력이 성공했습니다: ${formData.groupName}, ${formData.teamName}, ${formData.round} 내용이 잘 입력됐습니다.`);
        document.getElementById('popupConfirm').onclick = () => {
          if (currentRound === 10) {
            resetForm();
            showPage(1);
          } else {
            document.getElementById('round').value = `라운드${currentRound + 1}`;
            document.getElementById('choice').value = '';
            document.getElementById('percentage').value = '';
            document.getElementById('bet').value = '';
            formData.choice = '';
            formData.percentage = '';
            formData.bet = '';
            showPage(3);
          }
          document.getElementById('popup').style.display = 'none';
        };
        setTimeout(() => {
          isSubmitting = false;
          document.getElementById('submitBtn').disabled = false;
        }, 3000);
      });
    }

    function showPopup(message) {
      document.getElementById('popupMessage').textContent = message;
      document.getElementById('popup').style.display = 'block';
    }

    function resetForm() {
      formData = { groupName: '', teamName: '', round: '', choice: '', percentage: '', bet: '' };
      document.getElementById('groupName').value = '';
      document.getElementById('teamName').value = '';
      document.getElementById('round').value = '';
      document.getElementById('choice').value = '';
      document.getElementById('percentage').value = '';
      document.getElementById('bet').value = '';
    }

    document.addEventListener('DOMContentLoaded', () => {
      showPage(1);
    });
  </script>
</body>
</html>
