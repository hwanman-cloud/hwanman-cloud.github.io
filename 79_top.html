<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>환경 토론 투표 예측 게임</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    .btn {
      transition: all 0.2s ease-in-out;
    }
    .btn:hover {
      transform: scale(1.1);
      background-color: #2563eb;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      text-align: center;
    }
    #spinner-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body class="bg-blue-50 flex items-center justify-center min-h-screen p-4">
  <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-6">
    <!-- Page 1: Group Name -->
    <div id="page1" class="page">
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-4">환경 토론 투표 예측 게임(에너지 절약)</h1>
      <p class="text-gray-700 text-center mb-4">Host가 알려준 단체명을 입력합니다. 대소문자 구분해서 정확히 입력해 주세요.</p>
      <div class="flex items-center mb-4">
        <i class="fas fa-users mr-2 text-blue-500"></i>
        <input id="groupName" type="text" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="단체명 입력">
      </div>
      <button onclick="goToPage(2)" class="btn w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">다음</button>
    </div>

    <!-- Page 2: Team Name -->
    <div id="page2" class="page hidden">
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-2">환경 토론 투표 예측 게임(에너지 절약)</h1>
      <p class="text-gray-700 text-center mb-4">단체명: <span id="groupNameDisplay2" class="font-semibold"></span></p>
      <div class="flex items-center mb-4">
        <i class="fas fa-user-friends mr-2 text-blue-500"></i>
        <select id="teamName" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="" disabled selected>팀 선택</option>
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="flex space-x-2">
        <button onclick="goToPage(1)" class="btn flex-1 bg-gray-500 text-white p-2 rounded hover:bg-gray-600">뒤로 가기</button>
        <button onclick="goToPage(3)" class="btn flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">다음</button>
      </div>
    </div>

    <!-- Page 3: Round Selection -->
    <div id="page3" class="page hidden">
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-2">환경 토론 투표 예측 게임(에너지 절약)</h1>
      <p class="text-gray-700 text-center mb-2">단체명: <span id="groupNameDisplay3" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-4">팀명: <span id="teamNameDisplay3" class="font-semibold"></span></p>
      <div class="flex items-center mb-4">
        <i class="fas fa-list-ol mr-2 text-blue-500"></i>
        <select id="round" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="" disabled selected>라운드 선택</option>
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="flex space-x-2">
        <button onclick="goToPage(2)" class="btn flex-1 bg-gray-500 text-white p-2 rounded hover:bg-gray-600">뒤로 가기</button>
        <button onclick="goToPage(4)" class="btn flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">다음</button>
      </div>
    </div>

    <!-- Page 4: Choice Selection -->
    <div id="page4" class="page hidden">
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-2">환경 토론 투표 예측 게임(에너지 절약)</h1>
      <p class="text-gray-700 text-center mb-2">단체명: <span id="groupNameDisplay4" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-4">팀명: <span id="teamNameDisplay4" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-2">나의 선택</p>
      <div class="flex items-center mb-4">
        <i class="fas fa-check-circle mr-2 text-blue-500"></i>
        <select id="choice" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="" disabled selected>선택</option>
          <option value="찬성(1번)">찬성(1번)</option>
          <option value="반대(2번)">반대(2번)</option>
        </select>
      </div>
      <div class="flex space-x-2">
        <button onclick="goToPage(3)" class="btn flex-1 bg-gray-500 text-white p-2 rounded hover:bg-gray-600">뒤로 가기</button>
        <button onclick="goToPage(5)" class="btn flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">다음</button>
      </div>
    </div>

    <!-- Page 5: Prediction Percentage -->
    <div id="page5" class="page hidden">
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-2">환경 토론 투표 예측 게임(에너지 절약)</h1>
      <p class="text-gray-700 text-center mb-2">단체명: <span id="groupNameDisplay5" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-4">팀명: <span id="teamNameDisplay5" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-2">나의 선택과 같은 선택을 하는 % 예측</p>
      <div class="flex items-center mb-4">
        <i class="fas fa-percentage mr-2 text-blue-500"></i>
        <select id="prediction" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="" disabled selected>예측 % 선택</option>
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="flex space-x-2">
        <button onclick="goToPage(4)" class="btn flex-1 bg-gray-500 text-white p-2 rounded hover:bg-gray-600">뒤로 가기</button>
        <button onclick="goToPage(6)" class="btn flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">다음</button>
      </div>
    </div>

    <!-- Page 6: Bet Selection -->
    <div id="page6" class="page hidden">
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-2">환경 토론 투표 예측 게임(에너지 절약)</h1>
      <p class="text-gray-700 text-center mb-2">단체명: <span id="groupNameDisplay6" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-4">팀명: <span id="teamNameDisplay6" class="font-semibold"></span></p>
      <p class="text-gray-700 text-center mb-2">베팅 선택</p>
      <div class="flex items-center mb-4">
        <i class="fas fa-coins mr-2 text-blue-500"></i>
        <select id="bet" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="" disabled selected>베팅 선택</option>
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="flex space-x-2">
        <button onclick="goToPage(5)" class="btn flex-1 bg-gray-500 text-white p-2 rounded hover:bg-gray-600">뒤로 가기</button>
        <button onclick="submitData()" class="btn flex-1 bg-green-500 text-white p-2 rounded hover:bg-green-600">제출하기</button>
      </div>
    </div>

    <!-- Spinner Overlay -->
    <div id="spinner-overlay" class="hidden flex items-center justify-center">
      <div class="spinner"></div>
    </div>

    <!-- Popup -->
    <div id="popup" class="hidden">
      <p id="popup-message" class="text-gray-700 mb-4"></p>
      <button onclick="closePopup()" class="btn bg-blue-500 text-white p-2 rounded hover:bg-blue-600">확인</button>
    </div>
  </div>

  <script>
    let currentPage = 1;
    let formData = {
      groupName: '',
      teamName: '',
      round: '',
      choice: '',
      prediction: '',
      bet: ''
    };
    let isSubmitting = false;

    // Populate team options (1 to 60)
    const teamSelect = document.getElementById('teamName');
    for (let i = 1; i <= 60; i++) {
      const option = document.createElement('option');
      option.value = `팀 ${i}`;
      option.textContent = `팀 ${i}`;
      teamSelect.appendChild(option);
    }

    // Populate round options (1 to 10)
    const roundSelect = document.getElementById('round');
    for (let i = 1; i <= 10; i++) {
      const option = document.createElement('option');
      option.value = `라운드 ${i}`;
      option.textContent = `라운드 ${i}`;
      roundSelect.appendChild(option);
    }

    // Populate prediction options
    const predictionSelect = document.getElementById('prediction');
    const percentages = [2, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 98];
    percentages.forEach(p => {
      const option = document.createElement('option');
      option.value = p;
      option.textContent = `${p}%`;
      predictionSelect.appendChild(option);
    });

    // Populate bet options (1 to 9)
    const betSelect = document.getElementById('bet');
    for (let i = 1; i <= 9; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      betSelect.appendChild(option);
    }

    function goToPage(pageNumber) {
      // Save input data
      if (currentPage === 1) {
        formData.groupName = document.getElementById('groupName').value;
      } else if (currentPage === 2) {
        formData.teamName = document.getElementById('teamName').value;
      } else if (currentPage === 3) {
        formData.round = document.getElementById('round').value;
      } else if (currentPage === 4) {
        formData.choice = document.getElementById('choice').value;
      } else if (currentPage === 5) {
        formData.prediction = document.getElementById('prediction').value;
      }

      // Update display fields
      document.getElementById('groupNameDisplay2').textContent = formData.groupName;
      document.getElementById('groupNameDisplay3').textContent = formData.groupName;
      document.getElementById('teamNameDisplay3').textContent = formData.teamName;
      document.getElementById('groupNameDisplay4').textContent = formData.groupName;
      document.getElementById('teamNameDisplay4').textContent = formData.teamName;
      document.getElementById('groupNameDisplay5').textContent = formData.groupName;
      document.getElementById('teamNameDisplay5').textContent = formData.teamName;
      document.getElementById('groupNameDisplay6').textContent = formData.groupName;
      document.getElementById('teamNameDisplay6').textContent = formData.teamName;

      // Show/hide pages
      document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
      document.getElementById(`page${pageNumber}`).classList.remove('hidden');
      currentPage = pageNumber;

      // Auto-select next round if coming from submission
      if (pageNumber === 3 && formData.round) {
        const currentRound = parseInt(formData.round.split(' ')[1]);
        if (currentRound < 10) {
          document.getElementById('round').value = `라운드 ${currentRound + 1}`;
        }
      }
    }

function submitData() {
  if (isSubmitting) return;
  isSubmitting = true;

  formData.bet = document.getElementById('bet').value;
  if (!formData.bet) {
    alert('베팅을 선택해주세요.');
    isSubmitting = false;
    return;
  }

  const spinner = document.getElementById('spinner-overlay');
  const submitBtn = document.getElementById('submitBtn');
  spinner.style.display = 'flex';
  submitBtn.disabled = true;

  fetch('https://script.google.com/macros/s/AKfycbyiJTp574LatfGZKHGdyb-I0MDY-NQ3cEzdwlZTVxv9S5NA-8AjEbCJUqgUuc1KmQ5_/exec', {
    method: 'POST',
    mode: 'no-cors',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  })
  .then(() => {
    handleSubmissionSuccess();
  })
  .catch(() => {
    handleSubmissionSuccess(); // Handle as success due to no-cors
  });
}

function handleSubmissionSuccess() {
  const spinner = document.getElementById('spinner-overlay');
  const submitBtn = document.getElementById('submitBtn');
  spinner.style.display = 'none';

  const currentRoundNum = parseInt(formData.round.match(/\d+/)[0]);
  if (currentRoundNum < 10) {
    showPopup(`${formData.groupName}, ${formData.teamName}, ${formData.round} 내용이 잘 입력됐습니다.`);
    document.getElementById('popup').dataset.nextPage = 3;
    const nextRound = `라운드 ${currentRoundNum + 1}`;
    document.getElementById('round').value = nextRound;
    formData.round = nextRound; // Update formData for next round
  } else {
    showPopup('모든 입력이 완료되었습니다!');
    document.getElementById('popup').dataset.nextPage = 1;
  }

  // Reset fields for next round
  formData.choice = '';
  formData.prediction = '';
  formData.bet = '';
  document.getElementById('choice').value = '';
  document.getElementById('prediction').value = '';
  document.getElementById('bet').value = '';

  setTimeout(() => {
    submitBtn.disabled = false;
    isSubmitting = false;
  }, 3000);
}

    function showPopup(message) {
      document.getElementById('popup-message').textContent = message;
      document.getElementById('popup').style.display = 'block';
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
      const nextPage = parseInt(document.getElementById('popup').dataset.nextPage);
      goToPage(nextPage);
    }

    // Initialize
    goToPage(1);
  </script>
</body>
</html>
